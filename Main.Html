<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StudyPoint</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <style>
    :root{
      --background-dark:#151515;
      --surface-dark:#202020;
      --text-color:#ffffff;
      --border-color:#ffffff;
      --red-label:#ff3030;
      --blue-label:#0087ff;
      --green-label:#00ff2a;
      --light-grey:#a0a0a0;
      --orange-label:#FF8C42;
    }
    html,body{
      height:100%;
      margin:0;
      overflow:hidden;
    }
    body{
      font-family:'Fredoka One',cursive;
      background-color:var(--surface-dark);
      color:var(--text-color);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }
    .app-container{
      width:90%;
      height:90%;
      display:flex;
      flex-direction:column;
      border:5px solid var(--text-color);
      border-radius:40px;
      background-color:var(--background-dark);
      box-sizing:border-box;
      position:relative;
    }
    .header{
      text-align:center;
      padding:20px;
      font-size:3em;
      letter-spacing:2px;
      border-bottom:5px solid var(--text-color);
      box-shadow:0 4px 10px rgba(0,0,0,.5);
      margin:0 50px;
      z-index:10;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .points-display{
      font-size:1.5em;
      color:var(--orange-label);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .main-content{
      flex:1;
      display:flex;
      position:relative;
      padding:20px;
    }
    .sidebar{
      width:100px;height:80%;
      background-color:var(--background-dark);
      position:absolute;left:20px;top:50%;
      transform:translateY(-50%);
      border:5px solid var(--text-color);
      border-radius:40px;
      display:flex;flex-direction:column;
      justify-content:flex-start;align-items:center;
      padding-top:50px;gap:50px;z-index:20;
    }
    .sidebar-icon{
      width:70px;height:70px;border-radius:50%;
      background-color:#383838;border:3px solid var(--text-color);
      display:flex;justify-content:center;align-items:center;
      cursor:pointer;transition:background-color .3s;
    }
    .sidebar-icon:hover{ background-color:#555555; }
    .sidebar-icon.active{ background-color:#666666; }

    .content-area{
      flex-grow:1;
      margin-left:100px;
      padding:20px;
      box-sizing:border-box;
      display:flex;
      min-width:0;
      min-height:0;
      overflow:hidden;
    }
    .page{
      display:none;
      width:100%;height:100%;
      border:5px solid var(--text-color);
      border-radius:40px;
      background-color:var(--surface-dark);
      box-sizing:border-box;
      min-width:0;
      min-height:0;
    }
    .page.active{ display:flex; }

    /* Planning */
    #planning-page{
      flex-direction:column;justify-content:center;align-items:center;
      text-align:center;font-size:1.5em;gap:20px;padding:20px;
    }
    #planning-page iframe{
      width:100%;height:100%;border:none;border-radius:35px;
    }

    /* Révisions */
    #revisions-page{
      flex-direction:column;
      justify-content:flex-start;align-items:flex-start;
      padding:20px;
      width:calc(100% - 120px);
      margin-left:20px;
      overflow:hidden;
      min-height:0;
    }
    .notes-container{
      display:flex;flex-direction:row;gap:20px;
      height:353px;
      width:100%;
      box-sizing:border-box;
      overflow-x:auto;
      overflow-y:hidden;
      padding-bottom:10px;
      scroll-behavior:smooth;
    }
    .notes-container::-webkit-scrollbar{ height:10px; }
    .notes-container::-webkit-scrollbar-track{
      background:#2b2b2b;border-radius:10px;
    }
    .notes-container::-webkit-scrollbar-thumb{
      background-color:#555;border-radius:10px;border:2px solid #2b2b2b;
    }

    .fiche-card-add,.fiche-card{
      flex-shrink:0; width:300px;height:333px;border-radius:20px;
      border:3px solid var(--text-color); background-color:#555555;
      box-sizing:border-box;
    }
    .fiche-card-add{
      display:flex;justify-content:center;align-items:center;
      cursor:pointer;transition:transform .2s;
    }
    .fiche-card-add:hover{ transform:scale(1.05); }

    .fiche-card{
      display:flex;flex-direction:column;padding:20px;position:relative;
    }
    .fiche-card-title,.fiche-card-content{
      font-family:'Fredoka One',cursive;background:transparent;border:none;
      color:var(--text-color); width:100%; padding:5px; box-sizing:border-box;
      outline:none;
    }
    .fiche-card-title{ font-size:1.5em;text-align:center;margin-bottom:10px; }
    .fiche-card-content{
      flex:1;font-size:1em;resize:none;overflow-y:auto;
    }
    .fiche-card-delete{
      position:absolute;top:10px;right:10px;background-color:#ff3030;
      color:#fff;border:none;border-radius:5px;cursor:pointer;
      font-size:1em;padding:5px 10px;
    }

    /* Timer Page */
    #timer-page{
      flex-direction:row;
      justify-content:space-between;
      align-items:center;
      padding:30px;
      gap:30px;
    }
    .timer-section, .chrono-section{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding:20px; /* Rembourrage réduit */
      border:3px solid var(--text-color);
      border-radius:30px;
      background-color:rgba(255,140,66,0.05);
      height: 100%;
    }
    .timer-section .timer-display{
      font-size:2em; /* Taille encore réduite */
      color:var(--orange-label);
      text-shadow:2px 2px 4px rgba(0,0,0,0.5);
      margin:10px 0; /* Marge réduite */
      border:4px solid var(--orange-label);
      border-radius:20px;
      padding:10px 20px; /* Rembourrage encore réduit */
      background-color:rgba(0,0,0,0.3);
      min-width:200px; /* Largeur minimale réduite */
    }
    .timer-controls{
      display:flex;
      gap:10px; /* Espacement réduit */
      align-items:center;
      margin:10px 0; /* Marge réduite */
    }
    .timer-btn{
      font-family:'Fredoka One',cursive;
      font-size:1.1em; /* Taille de police réduite */
      padding:8px 20px; /* Rembourrage réduit */
      border:3px solid var(--text-color);
      border-radius:15px;
      background-color:var(--orange-label);
      color:var(--text-color);
      cursor:pointer;
      transition:all 0.3s;
      min-width:100px; /* Largeur minimale réduite */
    }
    .timer-btn:hover{
      background-color:#FF6B1A;
      transform:translateY(-2px);
    }
    .timer-btn:disabled{
      background-color:#666;
      cursor:not-allowed;
      transform:none;
    }
    .preset-times{
      display:flex;
      flex-wrap:wrap;
      gap:8px; /* Espacement réduit */
      margin:10px 0; /* Marge réduite */
      justify-content:center;
    }
    .preset-btn{
      font-family:'Fredoka One',cursive;
      padding:6px 12px; /* Rembourrage réduit */
      border:2px solid var(--orange-label);
      border-radius:10px; /* Bordure plus petite */
      background-color:transparent;
      color:var(--orange-label);
      cursor:pointer;
      transition:all 0.3s;
      font-size:0.9em; /* Taille de police réduite */
    }
    .preset-btn:hover, .preset-btn.active{
      background-color:var(--orange-label);
      color:var(--text-color);
    }
    
    .chrono-section{
      background-color:rgba(0,255,42,0.05);
      border:3px solid var(--green-label);
      padding:20px; /* Rembourrage réduit */
    }
    .chrono-section h2 {
      font-size: 1.2em; /* Taille encore réduite */
    }
    .chrono-display{
      font-size:2em; /* Taille encore réduite */
      color:var(--green-label);
      text-shadow:2px 2px 4px rgba(0,0,0,0.5);
      margin:10px 0; /* Marge réduite */
      border:4px solid var(--green-label);
      border-radius:20px;
      padding:10px 20px; /* Rembourrage encore réduit */
      background-color:rgba(0,0,0,0.3);
      min-width:200px; /* Largeur minimale réduite */
    }
    .chrono-controls{
      display:flex;
      gap:10px; /* Espacement réduit */
      align-items:center;
      margin:10px 0; /* Marge réduite */
    }
    .chrono-btn{
      font-family:'Fredoka One',cursive;
      font-size:1.1em; /* Taille de police réduite */
      padding:8px 20px; /* Rembourrage réduit */
      border:3px solid var(--text-color);
      border-radius:15px;
      background-color:var(--green-label);
      color:var(--text-color);
      cursor:pointer;
      transition:all 0.3s;
      min-width:100px; /* Largeur minimale réduite */
    }
    .chrono-btn:hover{
      background-color:#00E025;
      transform:translateY(-2px);
    }
    .chrono-btn:disabled{
      background-color:#666;
      cursor:not-allowed;
      transform:none;
    }
    
    .stats-section{
      position:absolute;
      bottom:20px; /* Position plus basse */
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:20px; /* Espacement réduit */
      padding:15px; /* Rembourrage réduit */
      border:3px solid var(--orange-label);
      border-radius:15px; /* Bordure plus petite */
      background-color:rgba(255,140,66,0.1);
      backdrop-filter:blur(5px);
    }
    .stat-item{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:3px; /* Espacement réduit */
      font-size:0.9em; /* Taille de police réduite */
      min-width:80px; /* Largeur minimale réduite */
    }
    .stat-value{
      font-size:1.1em; /* Taille de police réduite */
      color:var(--orange-label);
      font-weight:bold;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="points-display">
        <span>🏆</span>
        <span id="points-counter">0 pts</span>
      </div>
      <div>StudyPoint</div>
      <div style="width:150px;"></div>
    </div>

    <div class="main-content">
      <div class="sidebar">
        <div class="sidebar-icon" id="btn-planning">
          <svg width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#59A6FF"/>
            <rect x="25" y="25" width="50" height="50" rx="4" fill="#1B7FFF"/>
            <rect x="30" y="30" width="40" height="45" rx="3" fill="#59A6FF"/>
            <circle cx="35" cy="20" r="3" fill="#1B7FFF"/>
            <circle cx="45" cy="20" r="3" fill="#1B7FFF"/>
            <circle cx="55" cy="20" r="3" fill="#1B7FFF"/>
            <circle cx="65" cy="20" r="3" fill="#1B7FFF"/>
            <rect x="32" y="40" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="40" y="40" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="48" y="40" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="56" y="40" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="32" y="48" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="40" y="48" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="48" y="48" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="32" y="56" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <rect x="40" y="56" width="5" height="5" rx="1" fill="#1B7FFF"/>
            <circle cx="65" cy="65" r="8" fill="#59A6FF" stroke="#1B7FFF" stroke-width="2"/>
            <path d="M65 60V65L68 68" stroke="#1B7FFF" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="sidebar-icon" id="btn-revisions">
          <svg width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#7DDC62"/>
            <rect x="25" y="20" width="40" height="55" rx="4" fill="#4CAF3F"/>
            <rect x="28" y="23" width="34" height="49" rx="3" fill="#7DDC62"/>
            <path d="M35 38L31 34L33.5 31.5L35 33L41 27L44.5 30.5L38 37L35 38Z" fill="#4CAF3F"/>
            <rect x="46" y="32" width="12" height="4" rx="2" fill="#4CAF3F"/>
            <path d="M35 52L31 48L33.5 45.5L35 47L41 41L44.5 44.5L38 51L35 52Z" fill="#4CAF3F"/>
            <rect x="46" y="46" width="12" height="4" rx="2" fill="#4CAF3F"/>
            <path d="M35 66L31 62L33.5 59.5L35 61L41 55L44.5 58.5L38 65L35 66Z" fill="#4CAF3F"/>
            <rect x="46" y="60" width="12" height="4" rx="2" fill="#4CAF3F"/>
          </svg>
        </div>
        <div class="sidebar-icon" id="btn-timer">
          <svg width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#FF8C42"/>
            <circle cx="50" cy="55" r="30" fill="#FF6B1A" stroke="#FF3A00" stroke-width="3"/>
            <circle cx="50" cy="55" r="25" fill="#FF8C42"/>
            <path d="M50 30V55L65 70" stroke="#FF3A00" stroke-width="4" stroke-linecap="round"/>
            <circle cx="50" cy="55" r="3" fill="#FF3A00"/>
            <rect x="45" y="15" width="10" height="8" rx="2" fill="#FF6B1A"/>
            <rect x="35" y="20" width="8" height="6" rx="2" fill="#FF6B1A"/>
            <rect x="57" y="20" width="8" height="6" rx="2" fill="#FF6B1A"/>
          </svg>
        </div>
      </div>

      <div class="content-area">
        <div id="planning-page" class="page active">
          <iframe src="your link" frameborder="0" scrolling="no"></iframe>
        </div>

        <div id="revisions-page" class="page">
          <div class="notes-container">
            <div class="fiche-card-add" id="add-fiche-btn">
              <button style="border:none;background:none;color:white;font-size:100px;cursor:pointer;">+</button>
            </div>
          </div>
        </div>

        <div id="timer-page" class="page">
          <div class="timer-section">
            <h2 style="font-size:1.2em; margin:0 0 10px 0; color:var(--orange-label);">⏰ Timer Décompte</h2>
            
            <div class="preset-times">
              <button class="preset-btn" data-time="300">5 min</button>
              <button class="preset-btn active" data-time="900">15 min</button>
              <button class="preset-btn" data-time="1500">25 min</button>
              <button class="preset-btn" data-time="1800">30 min</button>
              <button class="preset-btn" data-time="3600">1 heure</button>
            </div>

            <div class="timer-display" id="timer-display">15:00</div>
            
            <div class="timer-controls">
              <button class="timer-btn" id="start-btn">▶️ Start</button>
              <button class="timer-btn" id="pause-btn" disabled>⏸️ Pause</button>
              <button class="timer-btn" id="stop-btn" disabled>⏹️ Stop</button>
            </div>
          </div>

          <div class="chrono-section">
            <h2 style="font-size:1.2em; margin:0 0 10px 0; color:var(--green-label);">⏱️ Chronomètre Libre</h2>
            
            <div style="margin:10px 0; color:var(--light-grey); font-size:0.9em;">
              Étudiez librement et égalisez vos points !<br>
              <span style="color:var(--green-label); font-size:1em;">1 minute = 1 point</span>
            </div>

            <div class="chrono-display" id="chrono-display">00:00</div>
            
            <div class="chrono-controls">
              <button class="chrono-btn" id="chrono-start-btn">▶️ Start</button>
              <button class="chrono-btn" id="chrono-pause-btn" disabled>⏸️ Pause</button>
              <button class="chrono-btn" id="chrono-stop-btn" disabled>⏹️ Stop</button>
            </div>
            
            <div style="margin-top:10px; padding:10px; border:2px solid var(--green-label); border-radius:10px; background-color:rgba(0,255,42,0.1);">
              <div style="font-size:1em; color:var(--green-label);">Points cette session: <span id="chrono-points">0</span></div>
            </div>
          </div>

          <div class="stats-section">
            <div class="stat-item">
              <span>Temps Total</span>
              <span class="stat-value" id="daily-time">0 min</span>
            </div>
            <div class="stat-item">
              <span>Sessions</span>
              <span class="stat-value" id="sessions-completed">0</span>
            </div>
            <div class="stat-item">
              <span>Points Gagnés</span>
              <span class="stat-value" id="points-earned">0 pts</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Gestion des données avec localStorage
    const DATA_KEY = 'webschool_data';
    
    function loadData() {
      const data = localStorage.getItem(DATA_KEY);
      return data ? JSON.parse(data) : {
        fiches: [],
        points: 0,
        dailyTime: 0,
        sessionsCompleted: 0,
        lastDate: new Date().toDateString()
      };
    }

    function saveData(data) {
      localStorage.setItem(DATA_KEY, JSON.stringify(data));
    }

    // Initialisation des données
    let appData = loadData();
    
    // Reset quotidien
    const today = new Date().toDateString();
    if (appData.lastDate !== today) {
      appData.dailyTime = 0;
      appData.sessionsCompleted = 0;
      appData.lastDate = today;
      saveData(appData);
    }

    // Variables pour le timer et chronomètre
    let timerInterval;
    let chronoInterval;
    let timeRemaining = 900; // 15 minutes par défaut
    let chronoTime = 0;
    let isTimerRunning = false;
    let isChronoRunning = false;
    let selectedTime = 900;
    let chronoSessionPoints = 0;

    // Éléments DOM
    const navPlanningBtn = document.getElementById('btn-planning');
    const navRevisionsBtn = document.getElementById('btn-revisions');
    const navTimerBtn = document.getElementById('btn-timer');
    const planningPage = document.getElementById('planning-page');
    const revisionsPage = document.getElementById('revisions-page');
    const timerPage = document.getElementById('timer-page');
    const notesContainer = document.querySelector('.notes-container');
    const addFicheBtn = document.getElementById('add-fiche-btn');
    
    // Timer elements
    const timerDisplay = document.getElementById('timer-display');
    const startBtn = document.getElementById('start-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const stopBtn = document.getElementById('stop-btn');
    
    // Chrono elements
    const chronoDisplay = document.getElementById('chrono-display');
    const chronoStartBtn = document.getElementById('chrono-start-btn');
    const chronoPauseBtn = document.getElementById('chrono-pause-btn');
    const chronoStopBtn = document.getElementById('chrono-stop-btn');
    const chronoPointsSpan = document.getElementById('chrono-points');
    
    // Stats elements
    const pointsCounter = document.getElementById('points-counter');
    const dailyTimeSpan = document.getElementById('daily-time');
    const sessionsCompletedSpan = document.getElementById('sessions-completed');
    const pointsEarnedSpan = document.getElementById('points-earned');

    // Preset buttons
    const presetBtns = document.querySelectorAll('.preset-btn');

    function updateUI() {
      pointsCounter.textContent = `${appData.points} pts`;
      dailyTimeSpan.textContent = `${Math.round(appData.dailyTime / 60)} min`;
      sessionsCompletedSpan.textContent = appData.sessionsCompleted;
      pointsEarnedSpan.textContent = `${appData.points} pts`;
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }

    function updateTimerDisplay() {
      timerDisplay.textContent = formatTime(timeRemaining);
    }

    function updateChronoDisplay() {
      chronoDisplay.textContent = formatTime(chronoTime);
      chronoSessionPoints = Math.floor(chronoTime / 60);
      chronoPointsSpan.textContent = chronoSessionPoints;
    }

    function calculatePoints(timeInSeconds) {
      // Plus de temps = plus de points
      // 1 point par minute, bonus pour les longues sessions
      const minutes = timeInSeconds / 60;
      let points = Math.floor(minutes);
      
      if (minutes >= 60) points += 30; // Bonus 1h+
      else if (minutes >= 30) points += 15; // Bonus 30min+
      else if (minutes >= 15) points += 5; // Bonus 15min+
      
      return points;
    }

    // Timer Functions
    function startTimer() {
      if (!isTimerRunning) {
        isTimerRunning = true;
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        stopBtn.disabled = false;
        
        timerInterval = setInterval(() => {
          timeRemaining--;
          updateTimerDisplay();
          
          if (timeRemaining <= 0) {
            completeTimerSession();
          }
        }, 1000);
      }
    }

    function pauseTimer() {
      if (isTimerRunning) {
        isTimerRunning = false;
        clearInterval(timerInterval);
        startBtn.disabled = false;
        pauseBtn.disabled = true;
      }
    }

    function stopTimer() {
      isTimerRunning = false;
      clearInterval(timerInterval);
      
      // Calculer le temps étudié
      const timeStudied = selectedTime - timeRemaining;
      if (timeStudied > 30) { // Minimum 30 secondes pour compter
        appData.dailyTime += timeStudied;
        const pointsGained = calculatePoints(timeStudied);
        appData.points += pointsGained;
        
        if (timeRemaining <= 0) {
          appData.sessionsCompleted++;
        }
        
        saveData(appData);
        updateUI();
      }
      
      // Reset
      timeRemaining = selectedTime;
      updateTimerDisplay();
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
    }

    function completeTimerSession() {
      isTimerRunning = false;
      clearInterval(timerInterval);
      
      appData.dailyTime += selectedTime;
      const pointsGained = calculatePoints(selectedTime);
      appData.points += pointsGained;
      appData.sessionsCompleted++;
      
      saveData(appData);
      updateUI();
      
      // Reset pour la prochaine session
      timeRemaining = selectedTime;
      updateTimerDisplay();
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      
      alert(`🎉 Session timer terminée ! +${pointsGained} points gagnés !`);
    }

    // Chronomètre Functions
    function startChrono() {
      if (!isChronoRunning) {
        isChronoRunning = true;
        chronoStartBtn.disabled = true;
        chronoPauseBtn.disabled = false;
        chronoStopBtn.disabled = false;
        
        chronoInterval = setInterval(() => {
          chronoTime++;
          updateChronoDisplay();
        }, 1000);
      }
    }

    function pauseChrono() {
      if (isChronoRunning) {
        isChronoRunning = false;
        clearInterval(chronoInterval);
        chronoStartBtn.disabled = false;
        chronoPauseBtn.disabled = true;
      }
    }

    function stopChrono() {
      isChronoRunning = false;
      clearInterval(chronoInterval);
      
      if (chronoTime > 30) { // Minimum 30 secondes pour compter
        appData.dailyTime += chronoTime;
        const pointsGained = Math.floor(chronoTime / 60); // 1 point par minute exactement
        appData.points += pointsGained;
        appData.sessionsCompleted++;
        
        saveData(appData);
        updateUI();
        
        alert(`🎉 Session chronomètre terminée ! +${pointsGained} points gagnés pour ${Math.floor(chronoTime / 60)} minutes d'étude !`);
      }
      
      // Reset
      chronoTime = 0;
      chronoSessionPoints = 0;
      updateChronoDisplay();
      chronoStartBtn.disabled = false;
      chronoPauseBtn.disabled = true;
      chronoStopBtn.disabled = true;
    }

    // Gestion des fiches
    function renderFiches() {
      document.querySelectorAll('.fiche-card').forEach(f => f.remove());
      appData.fiches.forEach((fiche, index) => {
        const card = document.createElement('div');
        card.className = 'fiche-card';
        card.innerHTML = `
          <input type="text" class="fiche-card-title" value="${fiche.title}" placeholder="Titre">
          <textarea class="fiche-card-content" placeholder="Notes...">${fiche.content}</textarea>
          <button class="fiche-card-delete" data-index="${index}">X</button>
        `;
        card.querySelector('.fiche-card-title').addEventListener('input', e => {
          appData.fiches[index].title = e.target.value;
          saveData(appData);
        });
        card.querySelector('.fiche-card-content').addEventListener('input', e => {
          appData.fiches[index].content = e.target.value;
          saveData(appData);
        });
        card.querySelector('.fiche-card-delete').addEventListener('click', () => {
          appData.fiches.splice(index, 1);
          renderFiches();
          saveData(appData);
        });
        notesContainer.insertBefore(card, addFicheBtn);
      });
    }

    function showPage(pageId) {
      // Remove active class from all icons and pages
      document.querySelectorAll('.sidebar-icon').forEach(icon => icon.classList.remove('active'));
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      
      // Add active class to current
      const activeIcon = document.getElementById(`btn-${pageId.replace('-page', '')}`);
      if (activeIcon) activeIcon.classList.add('active');
      
      const activePage = document.getElementById(pageId);
      if (activePage) activePage.classList.add('active');
    }

    // Event listeners
    navPlanningBtn.addEventListener('click', () => showPage('planning-page'));
    navRevisionsBtn.addEventListener('click', () => {
      showPage('revisions-page');
      renderFiches();
    });
    navTimerBtn.addEventListener('click', () => showPage('timer-page'));

    addFicheBtn.addEventListener('click', () => {
      appData.fiches.push({title: '', content: ''});
      renderFiches();
      saveData(appData);
    });

    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    stopBtn.addEventListener('click', stopTimer);

    // Chrono event listeners
    chronoStartBtn.addEventListener('click', startChrono);
    chronoPauseBtn.addEventListener('click', pauseChrono);
    chronoStopBtn.addEventListener('click', stopChrono);

    // Preset time buttons
    presetBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        if (!isTimerRunning) {
          presetBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          selectedTime = parseInt(btn.dataset.time);
          timeRemaining = selectedTime;
          updateTimerDisplay();
        }
      });
    });

    // Initialisation
    showPage('planning-page');
    updateTimerDisplay();
    updateChronoDisplay();
    updateUI();
    renderFiches();
  </script>
</body>

</html>
